# CSE3000 Research Project: Finding Different Ways to Break a Solver

This repository contains tools used by the CSE3000 Research Project Group 6: Finding different ways to break a solver.

**Note**: This branch contains only the relevant files for the paper: ["Methods for Evaluating the Similarity of Problem Instances Generated by Fuzzers for Model Counters"](https://repository.tudelft.nl/record/uuid:21e1e117-8531-4eec-b38b-b7d89199b213) by Cristian Soare. 

For the configurations used in this research, including generator configurations, solver configurations, and generation seeds, please consult the "csoare_cse3000_configs" directory.

The "csoare_cse3000_result_analysis" directory contains three essential Jupyter notebooks that implement key steps of our methodology:

- `sample_reduction_strategy2.ipynb`: Implementation of the instance reduction strategy
- `feature_analysis.ipynb`: Analysis of extracted instance features
- `result_analysis.ipynb`: Final analysis of fuzzing results

These notebooks correspond to three crucial steps in our methodology: reducing the instance set to a representative sample, analyzing the features of generated instances, and performing the final analysis of fuzzing results.

**Important Prerequisites**:

- The PairSAT and HornSAT instance generators, developed by Vuk Jurišić, require explicit permission from the author before use:
    - [PairSAT Generator](https://github.com/Chevuu/PairSAT)
    - [HornSAT Generator](https://github.com/Chevuu/HornSAT)
- The 2024 model counting solvers used in this research are available at [Zenodo](https://zenodo.org/records/14249109)
- The CPOG verification tool requires compilation of several dependencies. For detailed compilation instructions, please refer to the official [CPOG repository](https://github.com/rebryant/cpog)
- The SATzilla feature extractor requires:
    1. Compilation of the feature extraction tool (`features` binary)
    2. Creation of a "satzilla_Solvers" directory containing three specific solvers:
        - cadical2023
        - sbva
        - ubcsat2006
    3. Placement of all compiled binaries in "satzilla_feature_extractor/binaries"

    For complete setup instructions, please refer to the [Revisiting SATzilla repository](https://github.com/hadarshavit/revisiting_satzilla)


## Project Members

| Name | Github | Email |
|----------------|-------------------------------------------------|----------------------------------|
| Bram Snelten   | [BramyBoyGG](https://github.com/BramyBoyGG)     | <b.p.snelten@student.tudelft.nl> |
| Cristian Soare | [Krat-OS](https://github.com/Krat-OS)           | <c.soare@student.tudelft.nl>     |
| David Coroian  | [davidcoroian](https://github.com/davidcoroian) | <d.n.coroian@student.tudelft.nl> |
| Vuk Jurišić    | [JurisicChevu](https://github.com/Chevuu)       | <v.jurisic@student.tudelft.nl>   |

## Table of Contents

1. [Global CLI Tool](#global-cli-tool)
2. [DelftBlue Scripts](#delftblue-scripts)
3. [Project Components](#project-components)

## Global CLI Tool

The `global_cli.py` script serves as a unified command-line interface for various SAT-related operations with optional SLURM support. It provides four main subcommands:


### Set-up:

1. Python Environment Requirements:
   - Python version 3.11.9 is required
   - Ensure pip is installed and up to date

2. Create and Activate Virtual Environment:

   ```bash
   # Create virtual environment
   python3.11 -m venv .venv
   
   # Activate virtual environment
   # On Unix/macOS:
   source .venv/bin/activate
   # On Windows:
   .venv\Scripts\activate
   ```

3. Install Project Dependencies:

   ```bash
   # Install project in editable mode with all dependencies
   pip install -e .
   ```

4. Verify Installation:

   ```bash
   # Verify python version
   python --version  # Should output Python 3.11.9
   
   # Verify environment activation
   which python  # Should point to .venv/bin/python
   ```

### 1. Generate CNF Instances

```bash
python global_cli.py generate \
    --input-seeds <path/to/seeds.txt> \
    --generators <generator1.json> [<generator2.json> ...] \
    --num-iter <iterations> \
    --out-dir <output/directory> \
    [--use-slurm]
```

### 2. Fuzz CNF Instances

```bash
python global_cli.py fuzz \
    --instances <path/to/cnf/folder> \
    --solvers <solver1.json> [<solver2.json> ...] \
    --solver-timeout <seconds> \
    --out-dir <output/directory> \
    [--use-slurm]
```

### 3. CPOG Verification

```bash
python global_cli.py cpog_verify \
    [--csv-path <path/to/results.csv> | --cnf-path <path/to/single.cnf>] \
    [--verifier-dir <path/to/cpog/binaries>] \
    [--output-dir <output/directory>] \
    [--thread-timeout <seconds>] \
    [--max-workers <num>] \
    [--batch-size <size>] \
    [--memory-limit-gb <limit>]
```

### 4. SATzilla Feature Extraction

```bash
python global_cli.py satzilla_extract \
    --instances <path/to/cnf/folder> \
    --out-dir <output/directory> \
    --satzilla-binary-path <path/to/satzilla>
```

## DelftBlue Scripts

The repository includes several SLURM scripts for running operations on the [Delft High Performance Computing Centre (DHPC) DelftBlue Supercomputer (Phase 2)](https://www.tudelft.nl/dhpc/ark:/44463/DelftBluePhase2).

### 1. generate.sh

Generates CNF instances using SharpVelvet's generator:

```bash
sbatch generate.sh <GENERATOR_NAME> <INPUT_SEEDS> <NUM_ITER> <OUT_DIR>
# Example:
sbatch generate.sh MyGenerator input.txt 10 /home/user/out
```

### 2. fuzz.sh

Runs fuzzing operations with multiple solvers:

```bash
sbatch fuzz.sh <SOLVER_TIMEOUT> <INSTANCES_PATH> <OUTPUT_DIR> <SOLVER_NAME1> [SOLVER_NAME2 ...]
# Example:
sbatch fuzz.sh 60 /path/to/cnf /path/to/results MySolver1 MySolver2
```

### 3. cpog_verify.sh

Verifies CNF instances using CPOG:

```bash
sbatch cpog_verify.sh <CSV_FILE> <MAX_WORKERS> <THREAD_TIMEOUT> <BATCH_SIZE> <MEMORY_LIMIT_GB>
# Example:
sbatch cpog_verify.sh /path/to/fuzz-results.csv 4 120 10 8
```

### 4. satzilla_extract.sh

Extracts SATzilla features from CNF instances:

```bash
sbatch satzilla_extract.sh <INSTANCES_DIR>
# Example:
sbatch satzilla_extract.sh /path/to/cnf/folder
```

## Project Components

1. [SATZilla Feature Extractor](satzilla_feature_extractor/README.md)
2. [CPOG Verifier Tool](cpog_verifier/README.md)
3. [Delft Blue Scripts](delftblue/README.md)
4. [Final Paper Template/ Author's Kit (TeX source)](final-paper-template-tex/README.md)
5. [SharpVelvet (from meelgroup/SharpVelvet)](https://github.com/meelgroup/SharpVelvet/blob/master/README.md)
